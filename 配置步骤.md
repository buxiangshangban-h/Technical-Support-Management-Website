# 🎯 Supabase 配置步骤（请按顺序执行）

本文档提供清晰的配置步骤，帮助您实现本地和生产环境的数据同步。

---

## 📋 配置前检查

确认以下信息：

- ✅ Supabase URL: `https://sbp-a2e2xuudcasoe44t.supabase.opentrust.net`
- ✅ Supabase ANON KEY: `eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiYW5vbiIsInJlZiI6InNicC1hMmUyeHV1ZGNhc29lNDR0IiwiaXNzIjoic3VwYWJhc2UiLCJpYXQiOjE3NjAwNjU2MTMsImV4cCI6MjA3NTY0MTYxM30.keZ6_HXm3pgWaWZdD_2OFbGff89Gf6RDTM_b1340tiI`
- ✅ 项目使用 Vite（需要 `VITE_` 前缀，不是 `NEXT_PUBLIC_`）

---

## 第一步：配置本地开发环境

### 方法 1：一键配置（推荐）⭐

```bash
# 1. 运行配置脚本
npm run setup

# 2. 选择 "1. 使用默认配置（推荐）"

# 3. 按回车确认

# 4. 启动开发服务器
npm run dev
```

### 方法 2：手动配置

```bash
# 1. 复制环境变量模板
copy .env.example .env

# 2. 打开 .env 文件，确认内容：
# VITE_SUPABASE_URL=https://sbp-a2e2xuudcasoe44t.supabase.opentrust.net
# VITE_SUPABASE_ANON_KEY=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiYW5vbiIsInJlZiI6InNicC1hMmUyeHV1ZGNhc29lNDR0IiwiaXNzIjoic3VwYWJhc2UiLCJpYXQiOjE3NjAwNjU2MTMsImV4cCI6MjA3NTY0MTYxM30.keZ6_HXm3pgWaWZdD_2OFbGff89Gf6RDTM_b1340tiI

# 3. 启动开发服务器
npm run dev
```

### 验证本地配置

1. 访问 http://localhost:5173
2. 打开浏览器控制台（F12）
3. 检查：
   - ✅ 没有 "Supabase 未配置" 警告
   - ✅ 能看到 10 台设备数据
   - ✅ 可以编辑设备信息

**如果验证失败，请查看本文档末尾的"故障排查"部分。**

---

## 第二步：配置 Vercel 生产环境

### 1. 登录 Vercel

访问：https://vercel.com/dashboard

### 2. 找到项目

找到并点击 `Technical-Support-Management-Website` 项目

### 3. 进入环境变量设置

1. 点击 **Settings** 标签
2. 左侧菜单选择 **Environment Variables**
3. 点击 **Add New** 按钮

### 4. 添加第一个环境变量

```
Name: VITE_SUPABASE_URL
Value: https://sbp-a2e2xuudcasoe44t.supabase.opentrust.net
Environments: ✓ Production  ✓ Preview  ✓ Development
```

点击 **Save**

### 5. 添加第二个环境变量

```
Name: VITE_SUPABASE_ANON_KEY
Value: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiYW5vbiIsInJlZiI6InNicC1hMmUyeHV1ZGNhc29lNDR0IiwiaXNzIjoic3VwYWJhc2UiLCJpYXQiOjE3NjAwNjU2MTMsImV4cCI6MjA3NTY0MTYxM30.keZ6_HXm3pgWaWZdD_2OFbGff89Gf6RDTM_b1340tiI
Environments: ✓ Production  ✓ Preview  ✓ Development
```

点击 **Save**

### 6. 重新部署

1. 进入 **Deployments** 标签
2. 找到最新的部署
3. 点击右侧 "..." 菜单
4. 选择 **Redeploy**
5. 等待部署完成（约 2-3 分钟）

### 验证 Vercel 配置

1. 访问：https://www.joyboyjoyboy588.me
2. 强制刷新（Ctrl + F5）
3. 检查：
   - ✅ 能看到 10 台设备数据
   - ✅ 数据与本地一致
   - ✅ 可以编辑设备信息

**如果验证失败，请查看本文档末尾的"故障排查"部分。**

---

## 第三步：测试完整工作流

### 1. 本地修改数据

1. 在本地开发环境修改一台设备的信息
2. 刷新页面，修改应该保持

### 2. 验证云端同步

1. 访问 Supabase 控制台：https://supabase.opentrust.net
2. 进入项目：`sbp-a2e2xuudcasoe44t`
3. 查看 `devices` 表
4. 应该看到刚才的修改

### 3. 验证生产环境同步

1. 访问生产网站：https://www.joyboyjoyboy588.me
2. 强制刷新（Ctrl + F5）
3. 应该看到相同的修改

### 4. 测试自动部署

```bash
# 1. 修改一个文件（例如 README.md）
echo "测试自动部署" >> README.md

# 2. 提交并推送
git add .
git commit -m "测试自动部署流程"
git push origin main

# 3. 观察 Vercel 自动部署
# 访问 https://vercel.com/dashboard
# 应该看到新的部署正在进行

# 4. 等待部署完成后访问生产网站
# 应该看到最新的代码变更
```

---

## ✅ 配置完成检查清单

请逐项检查：

### 本地环境
- [ ] `.env` 文件已创建
- [ ] `.env` 文件包含 `VITE_SUPABASE_URL`
- [ ] `.env` 文件包含 `VITE_SUPABASE_ANON_KEY`
- [ ] 运行 `npm run dev` 无错误
- [ ] 访问 http://localhost:5173 能看到数据
- [ ] 浏览器控制台无 Supabase 配置警告
- [ ] 能编辑和保存数据

### Vercel 环境
- [ ] 已添加 `VITE_SUPABASE_URL` 环境变量
- [ ] 已添加 `VITE_SUPABASE_ANON_KEY` 环境变量
- [ ] 两个变量都勾选了 Production, Preview, Development
- [ ] 已重新部署项目
- [ ] 部署成功完成
- [ ] 访问生产网站能看到数据
- [ ] 生产数据与本地一致

### 完整工作流
- [ ] 本地修改数据后，Supabase 控制台能看到修改
- [ ] 本地修改数据后，生产环境刷新能看到修改
- [ ] 推送代码到 GitHub 后，Vercel 自动触发部署
- [ ] 自动部署成功完成
- [ ] 生产网站自动更新

**全部完成？恭喜！🎉 配置成功！**

---

## 🔧 故障排查

### 问题 1：本地显示 "Supabase 未配置" 警告

**检查步骤：**

```bash
# 1. 检查 .env 文件是否存在
dir .env

# 如果不存在，运行：
npm run setup

# 2. 检查 .env 文件内容
type .env

# 应该包含：
# VITE_SUPABASE_URL=https://sbp-a2e2xuudcasoe44t.supabase.opentrust.net
# VITE_SUPABASE_ANON_KEY=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...

# 3. 重启开发服务器
# Ctrl + C 停止
npm run dev
```

### 问题 2：Vercel 部署后仍显示演示数据

**检查步骤：**

1. 进入 Vercel Settings > Environment Variables
2. 确认变量名称：
   - ✅ 正确：`VITE_SUPABASE_URL`
   - ❌ 错误：`NEXT_PUBLIC_SUPABASE_URL`
3. 确认已勾选 **Production** 环境
4. 重新部署：Deployments > Redeploy
5. 清除浏览器缓存：Ctrl + Shift + Delete

### 问题 3：本地能连接，生产环境报错

**检查步骤：**

1. 打开浏览器控制台（F12）查看错误信息
2. 进入 Vercel Deployments 查看部署日志
3. 确认环境变量值没有多余的空格或引号：
   - ✅ 正确：`https://sbp-a2e2xuudcasoe44t.supabase.opentrust.net`
   - ❌ 错误：`"https://sbp-a2e2xuudcasoe44t.supabase.opentrust.net"`

### 问题 4：数据不同步

**检查步骤：**

1. 检查网络连接
2. 访问 Supabase 控制台确认项目状态：https://supabase.opentrust.net
3. 检查浏览器控制台是否有错误
4. 确认本地和 Vercel 使用相同的 URL 和 KEY

### 问题 5：推送代码后 Vercel 没有自动部署

**检查步骤：**

1. 访问 Vercel Dashboard
2. 检查 Settings > Git 集成是否正常
3. 手动触发部署：Deployments > Redeploy
4. 检查 GitHub 仓库的 webhook 设置

---

## 📚 相关文档

配置完成后，您可以参考以下文档深入学习：

- **[QUICK_START.md](./QUICK_START.md)** - 快速开始指南
- **[LOCAL_SETUP.md](./LOCAL_SETUP.md)** - 本地环境详细配置
- **[VERCEL_ENV_CONFIG.md](./VERCEL_ENV_CONFIG.md)** - Vercel 配置详解
- **[SUPABASE_SETUP.md](./SUPABASE_SETUP.md)** - Supabase 数据库配置
- **[SUPABASE_CONFIGURATION_SUMMARY.md](./SUPABASE_CONFIGURATION_SUMMARY.md)** - 配置总结

---

## 🎉 配置成功后的工作流程

```
日常开发流程：

1. 本地开发
   npm run dev
   → 修改代码
   → 测试功能
   → 数据自动同步到 Supabase

2. 提交代码
   git add .
   git commit -m "描述"
   git push origin main

3. 自动部署
   → GitHub 接收推送
   → Vercel 自动构建
   → 自动部署到生产环境

4. 验证
   → 访问生产网站
   → 确认功能正常
   → 数据与本地一致
```

---

## 🆘 需要帮助？

如果遇到问题：

1. **查看浏览器控制台**（F12 > Console）
2. **查看 Vercel 部署日志**（Deployments > 点击部署）
3. **查看 Supabase 项目状态**（https://supabase.opentrust.net）
4. **参考本文档的故障排查部分**
5. **查看详细文档**（上方"相关文档"部分）

---

**配置时间：** 2025-10-14  
**预计耗时：** 5-10 分钟  
**难度：** ⭐⭐☆☆☆（简单）
