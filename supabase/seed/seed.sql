-- supabase/seed/seed.sql
-- 技术支持管理网站种子数据脚本

-- 清理现有数据 (注意顺序，避免外键冲突)
TRUNCATE TABLE audit_log, price_history, maintenance_records, actions, stock_ledger, sim_cards, codes, assets, compatibilities, consumables, printer_models, suppliers, sops, locations RESTART IDENTITY CASCADE;

-- 插入位置数据
INSERT INTO locations (id, name, type) VALUES
('550e8400-e29b-41d4-a716-446655440001', '总仓库', '仓库'),
('550e8400-e29b-41d4-a716-446655440002', '展厅', '展厅'),
('550e8400-e29b-41d4-a716-446655440003', '李工', '个人'),
('550e8400-e29b-41d4-a716-446655440004', '在途中', '在途'),
('550e8400-e29b-41d4-a716-446655440005', '维修中心', '维修站');

-- 插入打印机型号数据
INSERT INTO printer_models (id, brand, model, notes) VALUES
('550e8400-e29b-41d4-a716-446655440101', 'DNP', 'DS40', '只支持专码'),
('550e8400-e29b-41d4-a716-446655440102', 'EPSON', 'L8058', '喷墨打印机'),
('550e8400-e29b-41d4-a716-446655440103', '西铁城', 'CX-02', '支持专码通码'),
('550e8400-e29b-41d4-a716-446655440104', '诚研', 'PS25L', '支持专码通码');

-- 插入耗材数据
INSERT INTO consumables (id, type, spec, unit) VALUES
('550e8400-e29b-41d4-a716-446655440201', '相纸', '6寸相纸', '张'),
('550e8400-e29b-41d4-a716-446655440202', '相纸', '8寸相纸', '张'),
('550e8400-e29b-41d4-a716-446655440203', '色带', 'DNP专用色带', '卷'),
('550e8400-e29b-41d4-a716-446655440204', '墨盒', 'EPSON原装墨盒', '个'),
('550e8400-e29b-41d4-a716-446655440205', '色带', '西铁城色带', '卷'),
('550e8400-e29b-41d4-a716-446655440206', '色带', '诚研色带', '卷');

-- 插入兼容性数据
INSERT INTO compatibilities (printer_model_id, consumable_id, code_type) VALUES
-- DNP DS40 兼容性 (只允许专码)
('550e8400-e29b-41d4-a716-446655440101', '550e8400-e29b-41d4-a716-446655440201', '专码'),
('550e8400-e29b-41d4-a716-446655440101', '550e8400-e29b-41d4-a716-446655440203', '专码'),
-- EPSON L8058 兼容性 (无需码)
('550e8400-e29b-41d4-a716-446655440102', '550e8400-e29b-41d4-a716-446655440204', '二选一'),
-- 西铁城 CX-02 兼容性 (支持专码通码)
('550e8400-e29b-41d4-a716-446655440103', '550e8400-e29b-41d4-a716-446655440201', '二选一'),
('550e8400-e29b-41d4-a716-446655440103', '550e8400-e29b-41d4-a716-446655440205', '二选一'),
-- 诚研 PS25L 兼容性 (支持专码通码)
('550e8400-e29b-41d4-a716-446655440104', '550e8400-e29b-41d4-a716-446655440202', '二选一'),
('550e8400-e29b-41d4-a716-446655440104', '550e8400-e29b-41d4-a716-446655440206', '二选一');

-- 插入打印机资产数据
INSERT INTO assets (id, asset_type, model_id, serial_no, status, location_id, owner_person) VALUES
('550e8400-e29b-41d4-a716-446655440301', '打印机', '550e8400-e29b-41d4-a716-446655440101', 'DNP001', '可用', '550e8400-e29b-41d4-a716-446655440001', NULL),
('550e8400-e29b-41d4-a716-446655440302', '打印机', '550e8400-e29b-41d4-a716-446655440102', 'EP001', '使用中', '550e8400-e29b-41d4-a716-446655440002', NULL),
('550e8400-e29b-41d4-a716-446655440303', '打印机', '550e8400-e29b-41d4-a716-446655440103', 'CX001', '可用', '550e8400-e29b-41d4-a716-446655440001', NULL),
('550e8400-e29b-41d4-a716-446655440304', '打印机', '550e8400-e29b-41d4-a716-446655440104', 'PS001', '维修中', '550e8400-e29b-41d4-a716-446655440005', NULL),
('550e8400-e29b-41d4-a716-446655440305', '打印机', '550e8400-e29b-41d4-a716-446655440101', 'DNP002', '借出', '550e8400-e29b-41d4-a716-446655440003', '李工');

-- 插入路由器资产数据
INSERT INTO assets (id, asset_type, serial_no, status, location_id, private_meta) VALUES
('550e8400-e29b-41d4-a716-446655440401', '路由器', 'HW001', '可用', '550e8400-e29b-41d4-a716-446655440001', '{"admin_password": "encrypted_password_1", "wifi_password": "encrypted_wifi_pass_1"}'),
('550e8400-e29b-41d4-a716-446655440402', '路由器', 'HW002', '使用中', '550e8400-e29b-41d4-a716-446655440002', '{"admin_password": "encrypted_password_2", "wifi_password": "encrypted_wifi_pass_2"}'),
('550e8400-e29b-41d4-a716-446655440403', '路由器', 'HW003', '可用', '550e8400-e29b-41d4-a716-446655440001', '{"admin_password": "encrypted_password_3", "wifi_password": "encrypted_wifi_pass_3"}');

-- 插入码数据
INSERT INTO codes (id, code_type, code_value, status, bound_printer_id) VALUES
('550e8400-e29b-41d4-a716-446655440501', '专码', 'DNP-SPEC-001', '已发', '550e8400-e29b-41d4-a716-446655440301'),
('550e8400-e29b-41d4-a716-446655440502', '专码', 'DNP-SPEC-002', '未发', NULL),
('550e8400-e29b-41d4-a716-446655440503', '通码', 'COMMON-001', '已发', NULL),
('550e8400-e29b-41d4-a716-446655440504', '通码', 'COMMON-002', '未发', NULL),
('550e8400-e29b-41d4-a716-446655440505', '专码', 'CX-SPEC-001', '未发', NULL);

-- 插入SIM卡数据
INSERT INTO sim_cards (id, iccid, carrier, status, plan, usage_mb, bound_router_id) VALUES
('550e8400-e29b-41d4-a716-446655440601', '89860318740123456789', '中国移动', '可用', '无限流量套餐', 2048, '550e8400-e29b-41d4-a716-446655440402'),
('550e8400-e29b-41d4-a716-446655440602', '89860318740987654321', '中国联通', '未激活', '50GB套餐', 0, NULL),
('550e8400-e29b-41d4-a716-446655440603', '89860318741111111111', '中国电信', '停机', '20GB套餐', 15360, NULL);

-- 插入供应商数据
INSERT INTO suppliers (id, name, contact) VALUES
('550e8400-e29b-41d4-a716-446655440701', 'DNP官方代理', '联系人：张先生 电话：13800138000'),
('550e8400-e29b-41d4-a716-446655440702', 'EPSON授权经销商', '联系人：李女士 电话：13900139000'),
('550e8400-e29b-41d4-a716-446655440703', '华为设备供应商', '联系人：王经理 电话：13700137000');

-- 插入价格历史数据 (演示数据，非真实价格)
INSERT INTO price_history (item_type, item_ref_id, price, supplier_id, happened_at) VALUES
('打印机', '550e8400-e29b-41d4-a716-446655440101', 8500.00, '550e8400-e29b-41d4-a716-446655440701', '2024-01-15'),
('打印机', '550e8400-e29b-41d4-a716-446655440102', 1200.00, '550e8400-e29b-41d4-a716-446655440702', '2024-02-01'),
('耗材', '550e8400-e29b-41d4-a716-446655440201', 0.80, '550e8400-e29b-41d4-a716-446655440701', '2024-01-20'),
('耗材', '550e8400-e29b-41d4-a716-446655440203', 120.00, '550e8400-e29b-41d4-a716-446655440701', '2024-01-20'),
('耗材', '550e8400-e29b-41d4-a716-446655440204', 85.00, '550e8400-e29b-41d4-a716-446655440702', '2024-02-05');

-- 插入SOP数据
INSERT INTO sops (id, title, asset_type, brand, model, steps) VALUES
('550e8400-e29b-41d4-a716-446655440801', 'EPSON L8058 装箱检查', '打印机', 'EPSON', 'L8058',
'[
  {"step": "检查外包装是否完整", "completed": false},
  {"step": "清点配件：电源线、USB线、说明书", "completed": false},
  {"step": "检查打印机外观无划痕", "completed": false},
  {"step": "通电测试打印机状态", "completed": false},
  {"step": "安装墨盒并执行清洗程序", "completed": false},
  {"step": "打印测试页确认打印质量", "completed": false}
]'),
('550e8400-e29b-41d4-a716-446655440802', '华为路由器恢复出厂设置', '路由器', '华为', 'ALL',
'[
  {"step": "确认路由器处于开机状态", "completed": false},
  {"step": "找到Reset按钮位置", "completed": false},
  {"step": "长按Reset按钮10秒直到指示灯闪烁", "completed": false},
  {"step": "等待路由器重启完成(约2分钟)", "completed": false},
  {"step": "使用默认管理员账号admin/admin登录", "completed": false},
  {"step": "重新配置WiFi名称和密码", "completed": false},
  {"step": "更新管理员密码", "completed": false}
]');

-- 插入初始库存记录
INSERT INTO stock_ledger (item_type, item_id, delta, balance, location_id, remark) VALUES
-- 耗材库存
('耗材', '550e8400-e29b-41d4-a716-446655440201', 500, 500, '550e8400-e29b-41d4-a716-446655440001', '初始入库'),
('耗材', '550e8400-e29b-41d4-a716-446655440202', 300, 300, '550e8400-e29b-41d4-a716-446655440001', '初始入库'),
('耗材', '550e8400-e29b-41d4-a716-446655440203', 50, 50, '550e8400-e29b-41d4-a716-446655440001', '初始入库'),
('耗材', '550e8400-e29b-41d4-a716-446655440204', 25, 25, '550e8400-e29b-41d4-a716-446655440001', '初始入库'),
('耗材', '550e8400-e29b-41d4-a716-446655440205', 30, 30, '550e8400-e29b-41d4-a716-446655440001', '初始入库'),
('耗材', '550e8400-e29b-41d4-a716-446655440206', 20, 20, '550e8400-e29b-41d4-a716-446655440001', '初始入库'),
-- 码库存
('码', '550e8400-e29b-41d4-a716-446655440501', 1, 0, '550e8400-e29b-41d4-a716-446655440001', '已发出'),
('码', '550e8400-e29b-41d4-a716-446655440502', 1, 1, '550e8400-e29b-41d4-a716-446655440001', '库存'),
('码', '550e8400-e29b-41d4-a716-446655440503', 1, 0, '550e8400-e29b-41d4-a716-446655440001', '已发出'),
('码', '550e8400-e29b-41d4-a716-446655440504', 1, 1, '550e8400-e29b-41d4-a716-446655440001', '库存'),
('码', '550e8400-e29b-41d4-a716-446655440505', 1, 1, '550e8400-e29b-41d4-a716-446655440001', '库存');

-- 插入一些示例维护记录
INSERT INTO maintenance_records (asset_id, title, detail, happened_at, performed_by) VALUES
('550e8400-e29b-41d4-a716-446655440304', '打印质量问题', '打印出现条纹，已更换色带并重新校准', '2024-09-15 14:30:00', '技术部-张工'),
('550e8400-e29b-41d4-a716-446655440302', '日常保养', '清洁打印头，检查墨水余量', '2024-09-20 09:00:00', '技术部-李工'),
('550e8400-e29b-41d4-a716-446655440401', '系统升级', '路由器固件升级至最新版本', '2024-09-25 16:00:00', '网络部-王工');

-- 插入一些示例操作记录
INSERT INTO actions (action_type, asset_type, asset_id, qty, from_location_id, to_location_id, by_user, at_time, related_person, work_order, remark) VALUES
('借用', '打印机', '550e8400-e29b-41d4-a716-446655440305', 1, '550e8400-e29b-41d4-a716-446655440001', '550e8400-e29b-41d4-a716-446655440003', '管理员', '2024-09-10 10:00:00', '李工', 'WO-2024-001', '临时使用'),
('调拨', '路由器', '550e8400-e29b-41d4-a716-446655440402', 1, '550e8400-e29b-41d4-a716-446655440001', '550e8400-e29b-41d4-a716-446655440002', '管理员', '2024-09-12 14:30:00', NULL, 'WO-2024-002', '展厅设备部署'),
('报修', '打印机', '550e8400-e29b-41d4-a716-446655440304', 1, '550e8400-e29b-41d4-a716-446655440002', '550e8400-e29b-41d4-a716-446655440005', '技术员', '2024-09-14 11:15:00', NULL, 'WO-2024-003', '打印质量异常'),
('耗材领用', '耗材', '550e8400-e29b-41d4-a716-446655440201', 50, '550e8400-e29b-41d4-a716-446655440001', '550e8400-e29b-41d4-a716-446655440002', '技术员', '2024-09-18 09:30:00', NULL, NULL, '展厅补充相纸');

-- 验证数据插入
SELECT 'Locations:', COUNT(*) FROM locations;
SELECT 'Printer Models:', COUNT(*) FROM printer_models;
SELECT 'Consumables:', COUNT(*) FROM consumables;
SELECT 'Assets:', COUNT(*) FROM assets;
SELECT 'Codes:', COUNT(*) FROM codes;
SELECT 'SIM Cards:', COUNT(*) FROM sim_cards;
SELECT 'Stock Ledger:', COUNT(*) FROM stock_ledger;
SELECT 'Actions:', COUNT(*) FROM actions;

-- 显示一些统计视图结果
SELECT 'Printer Counts by Status:' as info;
SELECT status, COUNT(*) as count FROM assets WHERE asset_type = '打印机' GROUP BY status;

SELECT 'Stock Levels:' as info;
SELECT * FROM v_stock_levels WHERE item_type = '耗材' ORDER BY current_stock ASC LIMIT 5;